
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Appendix A: RISCV &#8212; Tutorial: Creating an LLVM Toolchain for the Cpu0 Architecture</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/haiku.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="LLDB" href="lldb.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>Tutorial: Creating an LLVM Toolchain for the Cpu0 Architecture</span></a></h1>
        <h2 class="heading"><span>Appendix A: RISCV</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="lldb.html">LLDB</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="appendix-a-riscv">
<span id="sec-riscv"></span><h1>Appendix A: RISCV<a class="headerlink" href="#appendix-a-riscv" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#risc-compiler-toolchain-installatation" id="id2">RISC compiler toolchain installatation</a></p></li>
<li><p><a class="reference internal" href="#qemu-simulator" id="id3">Qemu simulator</a></p></li>
<li><p><a class="reference internal" href="#gem5-simulator" id="id4">Gem5 simulator</a></p></li>
<li><p><a class="reference internal" href="#rvv" id="id5">RVV</a></p></li>
</ul>
</div>
<p>This chapter shows the RISC toolchain installatation including gnu, llvm and
simulators on Linux.</p>
<section id="risc-compiler-toolchain-installatation">
<h2><a class="toc-backref" href="#id2">RISC compiler toolchain installatation</a><a class="headerlink" href="#risc-compiler-toolchain-installatation" title="Permalink to this headline">¶</a></h2>
<p>First, install the depended packages according
<a class="reference external" href="https://github.com/riscv-collab/riscv-gnu-toolchain#readme">https://github.com/riscv-collab/riscv-gnu-toolchain#readme</a>.
Next, create your $HOME/riscv and $HOME/riscv/git. Then run the following bash
script.</p>
<p class="rubric">exlbt/riscv/riscv-toolchain-setup.sh</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/usr/bin/env bash

# Verified on ubuntu 18.04
# mkdir riscv/git, riscv/riscv_newlib, riscv_linux befor running this bash script
export GNU_SRC_DIR=$HOME/riscv/git
export LLVM_SRC_DIR=$HOME/riscv/git

export GNU_NEWLIB_INSTALL_DIR=$HOME/riscv/riscv_newlib
export LLVM_NEWLIB_BUILD_DIR=$LLVM_SRC_DIR/llvm-project/build_riscv_newlib

export GNU_LINUX_INSTALL_DIR=$HOME/riscv/riscv_linux
export LLVM_LINUX_BUILD_DIR=$LLVM_SRC_DIR/llvm-project/build_riscv_linux

riscv_gnu_toolchain_prerequisites() {
  sudo apt-get install autoconf automake autotools-dev curl python3 libmpc-dev \
  libmpfr-dev libgmp-dev gawk build-essential bison flex texinfo gperf libtool \
  patchutils bc zlib1g-dev libexpat-dev
  if [ ! -f &quot;/usr/bin/python&quot; ]; then
    sudo ln -s /usr/bin/python3 /usr/bin/python
  fi
}

get_llvm() {
  if [ ! -d &quot;$GNU_SRC_DIR&quot; ]; then
    echo &quot;GNU_SRC_DIR: $GNU_SRC_DIR not exist&quot;
    exit 1
  fi
  pushd $LLVM_SRC_DIR
  git clone https://github.com/llvm/llvm-project.git
  cd llvm-project
  git checkout -b 13.x origin/release/13.x
  mkdir build_riscv_newlib
  mkdir build_riscv_linux
  popd
}

check() {
  if [ ! -d &quot;$GNU_SRC_DIR&quot; ]; then
    echo &quot;GNU_SRC_DIR: $GNU_SRC_DIR not exist&quot;
    exit 1
  fi
  if [ -d &quot;$GNU_NEWLIB_INSTALL_DIR&quot; ]; then
    echo &quot;GNU_NEWLIB_INSTALL_DIR: $GNU_NEWLIB_INSTALL_DIR exist. Remove it before running.&quot;
    exit 1
  fi
  if [ -d &quot;$GNU_LINUX_INSTALL_DIR&quot; ]; then
    echo &quot;GNU_LINUX_INSTALL_DIR: $GNU_LINUX_INSTALL_DIR exist. Remove it before running.&quot;
    exit 1
  fi
  if [ ! -d &quot;$LLVM_NEWLIB_BUILD_DIR&quot; ]; then
    echo &quot;LLVM_NEWLIB_BUILD_DIR: $LLVM_NEWLIB_BUILD_DIR not exist. Create it before running.&quot;
    exit 1
  fi
  if [ ! -d &quot;$LLVM_LINUX_BUILD_DIR&quot; ]; then
    echo &quot;LLVM_LINUX_BUILD_DIR: $LLVM_LINUX_BUILD_DIR not exist. Create it before running.&quot;
    exit 1
  fi
}

build_gnu_toolchain() {
  pushd $GNU_SRC_DIR
  git clone https://github.com/riscv/riscv-gnu-toolchain
  cd riscv-gnu-toolchain
#  Looks branch change from original/rvv-intrinsic to origin/__archive__
#  git checkout -b rvv-intrinsic origin/rvv-intrinsic
# commit 409b951ba6621f2f115aebddfb15ce2dd78ec24f of master branch is work for vadd.vv of vadd1.c
  mkdir build_newlib
  cd build_newlib
  ../configure --prefix=$GNU_NEWLIB_INSTALL_DIR \
  --with-multilib-generator=&quot;rv32i-ilp32--;rv32imafd-ilp32--;rv64ima-lp64--&quot;
  make

  cd ..
  mkdir build_linux
  cd build_linux
  ../configure --prefix=$GNU_LINUX_INSTALL_DIR
  make linux
  popd
}

# DEFAULT_SYSROOT: 
#   https://stackoverflow.com/questions/66357013/compile-clang-with-alternative-sysroot
# LLVM_DEFAULT_TARGET_TRIPLE:  
#   https://clang.llvm.org/docs/CrossCompilation.html#general-cross-compilation-options-in-clang
# Use &quot;clang --sysroot&quot; if did not &quot;cmake -DDEFAULT_SYSROOT&quot;
# $GNU_NEWLIB_INSTALL_DIR/clang --gcc-toolchain=$GNU_NEWLIB_INSTALL_DIR \
#   --sysroot=$GNU_NEWLIB_INSTALL_DIR/sysroot/ --static test.c
build_llvm_toolchain() {
  pushd $LLVM_NEWLIB_BUILD_DIR
  cmake -G &quot;Ninja&quot; -DCMAKE_BUILD_TYPE=Debug -DLLVM_TARGETS_TO_BUILD=&quot;RISCV&quot; \
  -DLLVM_ENABLE_PROJECTS=&quot;clang;lld&quot;  \
  -DLLVM_BINUTILS_INCDIR=$GNU_SRC_DIR/riscv-gnu-toolchain/riscv-binutils/include \
  -DCMAKE_INSTALL_PREFIX=$GNU_NEWLIB_INSTALL_DIR -DLLVM_PARALLEL_COMPILE_JOBS=4 \
  -DLLVM_PARALLEL_LINK_JOBS=1 -DLLVM_DEFAULT_TARGET_TRIPLE=riscv64-unknown-elf \
  -DDEFAULT_SYSROOT=$GNU_NEWLIB_INSTALL_DIR/riscv64-unknown-elf \
  -DLLVM_INSTALL_UTILS=ON ../llvm
  ninja
  ninja install
  popd
  pushd $LLVM_LINUX_BUILD_DIR
  cmake -G &quot;Ninja&quot; -DCMAKE_BUILD_TYPE=Debug -DLLVM_TARGETS_TO_BUILD=&quot;RISCV&quot; \
  -DLLVM_ENABLE_PROJECTS=&quot;clang;lld&quot;  \
  -DLLVM_BINUTILS_INCDIR=$GNU_SRC_DIR/riscv-gnu-toolchain/riscv-binutils/include \
  -DCMAKE_INSTALL_PREFIX=$GNU_LINUX_INSTALL_DIR -DLLVM_PARALLEL_COMPILE_JOBS=4 \
  -DLLVM_PARALLEL_LINK_JOBS=1 -DLLVM_DEFAULT_TARGET_TRIPLE=riscv64-unknown-linux-gnu \
  -DDEFAULT_SYSROOT=$GNU_LINUX_INSTALL_DIR/sysroot -DLLVM_INSTALL_UTILS=ON ../llvm
  ninja
  ninja install
  popd
}

riscv_gnu_toolchain_prerequisites;
get_llvm;
check;
build_gnu_toolchain;
build_llvm_toolchain;
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">pwd</span>
<span class="gp">$ </span><span class="nv">$HOME</span>/lbt/exlbt
<span class="gp">$ </span>bash riscv-toolchain-setup.sh
</pre></div>
</div>
<p>RISCV toolchain includes both baremetal(Newlib) and Linux platform support.</p>
</section>
<section id="qemu-simulator">
<h2><a class="toc-backref" href="#id3">Qemu simulator</a><a class="headerlink" href="#qemu-simulator" title="Permalink to this headline">¶</a></h2>
<p>Install according <a class="reference external" href="https://gitlab.com/qemu-project/qemu">https://gitlab.com/qemu-project/qemu</a> as follows,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">pwd</span>
<span class="gp">$ </span><span class="nv">$HOME</span>/riscv/git
<span class="gp">$ </span>git clone https://gitlab.com/qemu-project/qemu.git
<span class="gp">$ </span><span class="nb">cd</span> qemu
<span class="gp">$ </span>git log
<span class="go">commit a28498b1f9591e12dcbfdf06dc8f54e15926760e</span>
<span class="go">...</span>
<span class="gp">$ </span>mkdir build
<span class="gp">$ </span><span class="nb">cd</span> build
<span class="gp">$ </span>../configure
<span class="gp">$ </span>make
</pre></div>
</div>
<p>Then it can compile and run qemu for baremetal as follows,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">pwd</span>
<span class="gp">$ </span><span class="nv">$HOME</span>/lbt/exlbt/riscv
<span class="gp">$ </span><span class="nv">$HOME</span>/riscv/riscv_newlib/bin/clang -march<span class="o">=</span>rv64g hello.c -o hello_newlib
<span class="gp">$ </span><span class="nv">$HOME</span>/riscv/git/qemu/build/qemu-riscv64 hello_newlib
<span class="go">HelloWorld!</span>

<span class="gp">$ </span><span class="nv">$HOME</span>/riscv/riscv_newlib/bin/riscv64-unknown-elf-gcc -c hello_world.s
<span class="gp">$ </span><span class="nv">$HOME</span>/riscv/riscv_newlib/bin/riscv64-unknown-elf-ld hello_world.o -o hello_world
<span class="gp">$ </span><span class="nv">$HOME</span>/riscv/git/qemu/build/qemu-riscv64 hello_world
<span class="go">Hello World</span>
</pre></div>
</div>
<p>Linux as follows,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nv">$HOME</span>/riscv/riscv_linux/bin/clang -march<span class="o">=</span>rv64g hello.c -o hello_linux -static
<span class="gp">$ </span><span class="nv">$HOME</span>/riscv/git/qemu/build/qemu-riscv64 hello_linux
<span class="go">HelloWorld!</span>
</pre></div>
</div>
</section>
<section id="gem5-simulator">
<h2><a class="toc-backref" href="#id4">Gem5 simulator</a><a class="headerlink" href="#gem5-simulator" title="Permalink to this headline">¶</a></h2>
<p>Build Gem5 according the following,</p>
<p><a class="reference external" href="http://learning.gem5.org/book/part1/building.html#requirements-for-gem5">http://learning.gem5.org/book/part1/building.html#requirements-for-gem5</a></p>
<p>If you don’t have python3.x-config on Ubuntu 18.04 as follows,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ls /usr/bin/python*
<span class="go">... /usr/bin/python2.7-config</span>
</pre></div>
</div>
<p>Then do install by pip3 as follows <a class="footnote-reference brackets" href="#install-python3-config" id="id1">1</a>,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo apt install python3-pip
<span class="gp">$ </span>pip3 install scons
<span class="gp">$ </span>ls /usr/bin/python*
<span class="go">... /usr/bin/python3-config</span>
</pre></div>
</div>
<p>After install all dependencies, get gem5 and build RISCV as follows,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">pwd</span>
<span class="gp">$ </span><span class="nv">$HOME</span>/riscv/git
<span class="gp">$ </span>sudo apt install -y libglib2.0-dev
<span class="gp">$ </span>sudo apt install -y libpixman-1-dev
<span class="gp">$ </span>git clone https://gem5.googlesource.com/public/gem5
<span class="gp">$ </span><span class="nb">cd</span> gem5
<span class="gp">$ </span>git log
<span class="go">commit 846dcf0ba4eff824c295f06550b8673ff3f31314</span>
<span class="go">...</span>
<span class="gp">$</span>HOME/riscv/git/gem5$ /usr/bin/env python3 <span class="k">$(</span>which scons<span class="k">)</span> ./build/RISCV/gem5.debug -j4
<span class="go">...</span>
<span class="gp">$ </span><span class="nb">pwd</span>
<span class="gp">$ </span><span class="nv">$HOME</span>/lbt/exlbt/riscv
<span class="gp">$</span>HOME/lbt/exlbt/riscv$ <span class="nv">$HOME</span>/riscv/git/gem5/build/RISCV/gem5.debug <span class="se">\</span>
<span class="gp">$</span>HOME/riscv/git/gem5/configs/example/se.py --cmd<span class="o">=</span>./hello_newlib
<span class="go">**** REAL SIMULATION ****</span>
<span class="go">build/RISCV/sim/simulate.cc:107: info: Entering event queue @ 0.  Starting simulation...</span>
<span class="go">HelloWorld!</span>
</pre></div>
</div>
<p>Check cycles as follows,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span>HOME/lbt/exlbt/riscv$ vi m5out/stats.txt
<span class="go">simSeconds                                   0.000001                       # Number of seconds simulated (Second)</span>
<span class="go">simTicks                                      1229000                       # Number of ticks simulated (Tick)</span>
<span class="go">...</span>

<span class="gp">$</span>HOME/lbt/exlbt/riscv$ <span class="nv">$HOME</span>/riscv/git/gem5/build/RISCV/gem5.debug <span class="se">\</span>
/local/git/gem5/configs/example/se.py --cmd<span class="o">=</span>./hello_linux
<span class="go">...</span>
<span class="go">HelloWorld!</span>
<span class="go">...</span>
</pre></div>
</div>
<p>The config of gem5 reference here.
<a class="reference external" href="http://learning.gem5.org/book/part1/example_configs.html">http://learning.gem5.org/book/part1/example_configs.html</a></p>
</section>
<section id="rvv">
<h2><a class="toc-backref" href="#id5">RVV</a><a class="headerlink" href="#rvv" title="Permalink to this headline">¶</a></h2>
<p>Clang/llvm provide RVV (RISC-V Vectors) written in C rather than inline-asm.
Though it notices as clang option: -target-feature +experimental-v, this way in
C is more friendly and easy to remember for users than in inline-asm form.
Builtin is C function and friendly either. RVV can be written and run as follows,</p>
<p class="rubric">exlbt/riscv/vadd1.c</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="o">~/</span><span class="n">riscv</span><span class="o">/</span><span class="n">riscv_newlib</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">clang</span><span class="o">++</span> <span class="n">vadd1</span><span class="o">.</span><span class="n">c</span> <span class="o">-</span><span class="n">menable</span><span class="o">-</span><span class="n">experimental</span><span class="o">-</span><span class="n">extensions</span> <span class="o">-</span><span class="n">march</span><span class="o">=</span><span class="n">rv64gcv0p10</span> <span class="o">-</span><span class="n">O0</span> <span class="o">-</span><span class="n">mllvm</span> <span class="o">--</span><span class="n">riscv</span><span class="o">-</span><span class="n">v</span><span class="o">-</span><span class="n">vector</span><span class="o">-</span><span class="n">bits</span><span class="o">-</span><span class="nb">min</span><span class="o">=</span><span class="mi">256</span> <span class="o">-</span><span class="n">v</span>
<span class="o">//</span> <span class="o">~/</span><span class="n">riscv</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">qemu</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">qemu</span><span class="o">-</span><span class="n">riscv64</span> <span class="o">-</span><span class="n">cpu</span> <span class="n">rv64</span><span class="p">,</span><span class="n">v</span><span class="o">=</span><span class="n">true</span> <span class="n">a</span><span class="o">.</span><span class="n">out</span>
<span class="o">//</span> <span class="n">ref</span><span class="o">.</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pages</span><span class="o">.</span><span class="n">dogdog</span><span class="o">.</span><span class="n">run</span><span class="o">/</span><span class="n">toolchain</span><span class="o">/</span><span class="n">riscv_vector_extension</span><span class="o">.</span><span class="n">html</span>

<span class="c1">#include &lt;riscv_vector.h&gt;</span>
<span class="c1">#include &lt;stdio.h&gt;</span>

<span class="n">void</span> <span class="n">vec_add_rvv</span><span class="p">(</span><span class="nb">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="nb">int</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="nb">int</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">size_t</span> <span class="n">vl</span><span class="p">;</span>
    <span class="n">vint32m2_t</span> <span class="n">va</span><span class="p">,</span> <span class="n">vb</span><span class="p">,</span> <span class="n">vc</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(;</span> <span class="n">vl</span> <span class="o">=</span> <span class="n">vsetvl_e32m2</span><span class="p">(</span><span class="n">n</span><span class="p">);</span> <span class="n">n</span> <span class="o">-=</span> <span class="n">vl</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">vb</span> <span class="o">=</span> <span class="n">vle32_v_i32m2</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">vl</span><span class="p">);</span>
        <span class="n">vc</span> <span class="o">=</span> <span class="n">vle32_v_i32m2</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">vl</span><span class="p">);</span>
        <span class="n">va</span> <span class="o">=</span> <span class="n">vadd_vv_i32m2</span><span class="p">(</span><span class="n">vb</span><span class="p">,</span> <span class="n">vc</span><span class="p">,</span> <span class="n">vl</span><span class="p">);</span>
        <span class="n">vse32_v_i32m2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">va</span><span class="p">,</span> <span class="n">vl</span><span class="p">);</span>
        <span class="n">a</span> <span class="o">+=</span> <span class="n">vl</span><span class="p">;</span>
        <span class="n">b</span> <span class="o">+=</span> <span class="n">vl</span><span class="p">;</span>
        <span class="n">c</span> <span class="o">+=</span> <span class="n">vl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">int</span> <span class="n">x</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
<span class="nb">int</span> <span class="n">y</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">};</span>
<span class="nb">int</span> <span class="n">z</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">vec_add_rvv</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">pwd</span>
<span class="gp">$ </span><span class="nv">$HOME</span>/lbt/exlbt/riscv
<span class="gp">$ </span><span class="nv">$HOME</span>/riscv/riscv_newlib/bin/clang vadd1.c -menable-experimental-extensions <span class="se">\</span>
  -march<span class="o">=</span>rv64gcv0p10 -O0 -mllvm --riscv-v-vector-bits-min<span class="o">=</span><span class="m">256</span>
<span class="gp">$ </span><span class="nv">$HOME</span>/riscv/git/qemu/build/qemu-riscv64 -cpu rv64,v<span class="o">=</span><span class="nb">true</span> a.out
<span class="go">vector version is not specified, use the default value v1.0</span>
<span class="go">1 11 11 11 11 11 11 11 11 1</span>

<span class="gp">$ </span><span class="nv">$HOME</span>/riscv/riscv_newlib/bin/clang vadd1.c -menable-experimental-extensions <span class="se">\</span>
  -march<span class="o">=</span>rv64gcv0p10 -O0 -mllvm --riscv-v-vector-bits-min<span class="o">=</span><span class="m">256</span> -static
<span class="gp">$ </span><span class="nv">$HOME</span>/riscv/git/qemu/build/qemu-riscv64 -cpu rv64,v<span class="o">=</span><span class="nb">true</span> a.out
<span class="go">vector version is not specified, use the default value v1.0</span>
<span class="go">1 11 11 11 11 11 11 11 11 1</span>
<span class="gp">$ </span><span class="nv">$HOME</span>/riscv/riscv_newlib/bin/riscv64-unknown-elf-objdump -d a.out<span class="p">|</span>grep vadd.vv
<span class="go"> 106fc:       03ae0d57                vadd.vv v26,v26,v28</span>
</pre></div>
</div>
<p>Clang/llvm provide builtin and intrinsic functions to implement RVV (RISC-V
Vectors)</p>
<p class="rubric">~/riscv/git/llvm-project/clang/include/clang/Basic/riscv_vector.td</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#define vsetvl_e8mf8(avl) __builtin_rvv_vsetvli((size_t)(avl), 0, 5)</span>
<span class="p">...</span><span class="w"></span>
<span class="n">defm</span><span class="w"> </span><span class="n">vmadd</span><span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="n">RVVIntTerBuiltinSet</span><span class="p">;</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
<span class="n">defm</span><span class="w"> </span><span class="n">vfdiv</span><span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="n">RVVFloatingBinBuiltinSet</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p class="rubric">~/riscv/git/llvm-project/llvm/include/llvm/IR/IntrinsicsRISCV.td</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">def</span><span class="w"> </span><span class="n">int_riscv_vsetvli</span><span class="w">   </span><span class="o">:</span><span class="w"> </span><span class="n">Intrinsic</span><span class="o">&lt;</span><span class="p">...</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
<span class="n">defm</span><span class="w"> </span><span class="n">vmadd</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">RISCVTernaryAAXA</span><span class="p">;</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>
<span class="n">defm</span><span class="w"> </span><span class="n">vfdiv</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">RISCVBinaryAAX</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Refer to clang/llvm test cases in the following folders.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>~/riscv/git/llvm-project/clang/test/CodeGen/RISCV/rvv-intrinsics$ ls
<span class="gp">$ </span>... vfdiv.c ... vfmadd.c

<span class="gp">$ </span>~/riscv/git/llvm-project/llvm/test/CodeGen/RISCV/rvv$ ls
<span class="gp">$ </span>... vfdiv-rv64.ll ... vfmadd-rv64.ll ...
</pre></div>
</div>
<dl class="footnote brackets">
<dt class="label" id="install-python3-config"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p><a class="reference external" href="https://www.anycodings.com/questions/gem5-build-fails-with-embedded-python-library-36-or-newer-required-found-2717">https://www.anycodings.com/questions/gem5-build-fails-with-embedded-python-library-36-or-newer-required-found-2717</a></p>
</dd>
</dl>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="lldb.html">LLDB</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Chen Chung-Shu.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>