
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>About &#8212; Tutorial: Creating an LLVM Toolchain for the Cpu0 Architecture</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/haiku.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="#" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Clang" href="clang.html" />
    <link rel="prev" title="Table of Contents" href="index.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>Tutorial: Creating an LLVM Toolchain for the Cpu0 Architecture</span></a></h1>
        <h2 class="heading"><span>About</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="index.html">Table of Contents</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="clang.html">Clang</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="about">
<span id="sec-about"></span><h1>About<a class="headerlink" href="#about" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#authors" id="id10">Authors</a></p></li>
<li><p><a class="reference internal" href="#acknowledgments" id="id11">Acknowledgments</a></p></li>
<li><p><a class="reference internal" href="#build-steps" id="id12">Build steps</a></p></li>
<li><p><a class="reference internal" href="#revision-history" id="id13">Revision history</a></p></li>
<li><p><a class="reference internal" href="#licensing" id="id14">Licensing</a></p></li>
<li><p><a class="reference internal" href="#outline-of-chapters" id="id15">Outline of Chapters</a></p></li>
</ul>
</nav>
<section id="authors">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Authors</a><a class="headerlink" href="#authors" title="Permalink to this heading">¶</a></h2>
<img alt="_images/Author_ChineseName.png" class="align-right" src="_images/Author_ChineseName.png" />
<p>Chen Chung-Shu</p>
<p><a class="reference external" href="mailto:gamma_chen&#37;&#52;&#48;yahoo&#46;com&#46;tw">gamma_chen<span>&#64;</span>yahoo<span>&#46;</span>com<span>&#46;</span>tw</a></p>
<p><a class="reference external" href="http://jonathan2251.github.io/web/index.html">http://jonathan2251.github.io/web/index.html</a></p>
</section>
<section id="acknowledgments">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Acknowledgments</a><a class="headerlink" href="#acknowledgments" title="Permalink to this heading">¶</a></h2>
<p>I would like to thank Sean Silva, <a class="reference external" href="mailto:chisophugis&#37;&#52;&#48;gmail&#46;com">chisophugis<span>&#64;</span>gmail<span>&#46;</span>com</a>, for his help,
encouragement, and assistance with the Sphinx document generator.
Without his help, this book would not have been finished and published online.
Also thanking those corrections from readers who make the book more accurate.</p>
</section>
<section id="build-steps">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">Build steps</a><a class="headerlink" href="#build-steps" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://github.com/Jonathan2251/lbt/blob/master/README.md">https://github.com/Jonathan2251/lbt/blob/master/README.md</a></p>
</section>
<section id="revision-history">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">Revision history</a><a class="headerlink" href="#revision-history" title="Permalink to this heading">¶</a></h2>
<p>Version 12.0.14, not released yet.</p>
<p>Version 12.0.13, Released July 15, 2023.</p>
<blockquote>
<div><p>riscv.rst: AnLLVMBasedNPUCompiler.key.</p>
</div></blockquote>
<p>Version 12.0.12, Released April 4, 2023.</p>
<blockquote>
<div><p>riscv.rst: The advantage of RISCV little endians.</p>
</div></blockquote>
<p>Version 12.0.11, Released Feburary 27, 2023.</p>
<blockquote>
<div><p>riscv.rst: section Linker Command.
pocl.rst, riscv.rst: books and document.
some example-code on exlbt/riscv/.
loop-convert2, Rewriter and PrintFunction in exlbt/clang-tools.</p>
</div></blockquote>
<p>Version 12.0.10, Release November 13, 2022.</p>
<blockquote>
<div><p>clang.rst:section Builtin functions.
lib.rst:section Compiler-rt’s builtins.
pocl.rst.
riscv.rst:table:: RISCV toolchain, sections Mem and Resources.</p>
</div></blockquote>
<p>Version 12.0.9, Release September 24, 2022.</p>
<blockquote>
<div><p>GDB section and refine Makefile bash</p>
</div></blockquote>
<p>Version 12.0.8, Release September 8, 2022.</p>
<blockquote>
<div><p>Appendix A: add sections ISA and RISCV Calling Convention.
Add Appendix B: Clang-tools.</p>
</div></blockquote>
<p>Version 12.0.7, Release August 16, 2022.</p>
<blockquote>
<div><p>Appendix A: RISCV</p>
</div></blockquote>
<p>Version 12.0.6, Released February 3, 2022.</p>
<blockquote>
<div><p>scanf and printf.</p>
</div></blockquote>
<p>Version 12.0.5, Released February 1, 2022.</p>
<blockquote>
<div><p>Newlib/libm and complex type test for builtins-test.</p>
</div></blockquote>
<p>Version 12.0.4, Released January 22, 2022.</p>
<blockquote>
<div><p>sanitizer-printf for supporting printf(“%lld”) or “%llX”, …, etc.
Pass test cases in compiler-rt-test/builtins/Unit include type float and double
exclude complex.</p>
</div></blockquote>
<p>Version 12.0.3, Released January 9, 2022.</p>
<blockquote>
<div><p>Expand memory size of cpu0.v to 0x1000000, 24-bit.
Add all compiler-rt-test/builtins/Unit/*.c.</p>
</div></blockquote>
<p>Version 12.0.2, Release December 18, 2021.</p>
<blockquote>
<div><p>Replace bash with Makefile.
Add builtins-cpu0.c for clang regression test.</p>
</div></blockquote>
<p>Version 12.0.1, Release December 12, 2021.</p>
<blockquote>
<div><p>Add target Cpu0 to clang</p>
</div></blockquote>
<p>Version 12.0.0, Release Auguest 11, 2021.</p>
<p>Version 3.9.1, Released April 29, 2020</p>
<blockquote>
<div><p>Enable tailcall test option in build-slinker.sh</p>
</div></blockquote>
<p>Version 3.9.0, Released November 22, 2016</p>
<blockquote>
<div><p>Porting to llvm 3.9.</p>
</div></blockquote>
<p>Version 3.7.4, Released September 22, 2016</p>
<blockquote>
<div><p>Split elf2hex-dlinker.cpp from elf2hex.cpp in exlbt/elf2hex.</p>
</div></blockquote>
<p>Version 3.7.3, Released July 20, 2016</p>
<blockquote>
<div><p>Refine code-block according sphinx lexers.
Add search this book.</p>
</div></blockquote>
<p>Version 3.7.2, Released June 29, 2016</p>
<blockquote>
<div><p>Dynamic linker change display from ret $t9 to jr $t9.
Move llvm-objdump -elf2hex to elf2hex.
Upgrade sphinx to 1.4.4.</p>
</div></blockquote>
<p>Version 3.7.1, Released November 7, 2015</p>
<blockquote>
<div><p>Remove EM_CPU0_EL.
Add IR blockaddress and indirectbr support.
Add ch_9_3_detect_exception.cpp test.
Change display “ret $rx” to “jr $rx” where $rx is not $lr.
Add Phi node test.</p>
</div></blockquote>
<p>Version 3.7.0, Released September 24, 2015</p>
<blockquote>
<div><p>Porting to lld 3.7.</p>
</div></blockquote>
<p>Version 3.6.2, Released May 4, 2015</p>
<blockquote>
<div><p>Move some test from lbt to lbd.
Remove warning in build Cpu0 code.</p>
</div></blockquote>
<dl class="simple">
<dt>Version 3.6.1, Released March 22, 2015</dt><dd><p>Correct typing.</p>
</dd>
<dt>Version 3.6.0, Released March 8, 2015</dt><dd><p>Porting to lld 3.6.</p>
</dd>
</dl>
</section>
<section id="licensing">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">Licensing</a><a class="headerlink" href="#licensing" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="http://llvm.org/docs/DeveloperPolicy.html#license">http://llvm.org/docs/DeveloperPolicy.html#license</a></p>
</section>
<section id="outline-of-chapters">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">Outline of Chapters</a><a class="headerlink" href="#outline-of-chapters" title="Permalink to this heading">¶</a></h2>
<figure class="align-center" id="id8">
<span id="about-f1"></span><a class="reference internal image-reference" href="_images/mywork_1.png"><img alt="_images/mywork_1.png" src="_images/mywork_1.png" style="width: 1194.0px; height: 411.0px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2 </span><span class="caption-text">Code generation and execution flow</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>The upper half of <a class="reference internal" href="#about-f1"><span class="std std-numref">Fig. 2</span></a> is the work flow and software package
of a computer program be generated and executed. IR stands for Intermediate
Representation.
The lower half is this book’s work flow and software package of the toolchain
extended implementation based on llvm. Except clang, the other blocks need to
be extended for a new backend development. This book implement the green boxes
part.
The Cpu0 llvm backend can be find on
<a class="reference external" href="http://jonathan2251.github.io/lbd/index.html">http://jonathan2251.github.io/lbd/index.html</a>.</p>
<table class="docutils align-default" id="id9">
<caption><span class="caption-number">Table 1 </span><span class="caption-text">Toolchain components <a class="footnote-reference brackets" href="#toolchain" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a> <a class="footnote-reference brackets" href="#toolchain2" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a></span><a class="headerlink" href="#id9" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Component</p></th>
<th class="head"><p>LLVM</p></th>
<th class="head"><p>GNU <a class="footnote-reference brackets" href="#gnu" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>C/C++ Compiler</p></td>
<td><p>clang/llvm</p></td>
<td><p>gcc</p></td>
</tr>
<tr class="row-odd"><td><p>Assembler</p></td>
<td><p>llvm integrated assembler</p></td>
<td><p>as</p></td>
</tr>
<tr class="row-even"><td><p>Linker</p></td>
<td><p>ld.lld</p></td>
<td><p>ld.bfd ld.gold</p></td>
</tr>
<tr class="row-odd"><td><p>Runtime</p></td>
<td><p>compiler-rt</p></td>
<td><p>libgcc <a class="footnote-reference brackets" href="#libgcc" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a></p></td>
</tr>
<tr class="row-even"><td><p>Unwinder</p></td>
<td><p>libunwind</p></td>
<td><p>libgcc_s</p></td>
</tr>
<tr class="row-odd"><td><p>C++ library</p></td>
<td><p>libc++abi, libc++</p></td>
<td><p>libsupc++ libstdc++</p></td>
</tr>
<tr class="row-even"><td><p>Utils</p></td>
<td><p>llvm-ar, llvm-objdump etc.</p></td>
<td><p>ar, objdump etc.</p></td>
</tr>
<tr class="row-odd"><td><p>C library</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>libc</p></td>
</tr>
</tbody>
</table>
<p>The libgcc’s Integer plus Soft float library <a class="footnote-reference brackets" href="#libgcc" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a> <a class="footnote-reference brackets" href="#integer-lib" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>
<a class="footnote-reference brackets" href="#soft-float-lib" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a> are equal to functions of compiler-rt’s builtins.</p>
<p>This book include:</p>
<ol class="arabic simple">
<li><p>Add Cpu0 target to clang.</p></li>
<li><p>The elf2hex extended from llvm-objump. Chapter 3.</p></li>
<li><p>Optimization. Chapter 4.</p></li>
<li><p>Porting C standard library from avr libc and software floating point library
from LLVM compiler-rt.</p></li>
</ol>
<p>With these implementation, reader can generate Cpu0 machine code through Cpu0
llvm backend compiler, linker and elf2hex, then see how it runs on your
computer.</p>
<p><a class="reference internal" href="clang.html#sec-clang"><span class="std std-ref">Clang</span></a>:</p>
<p>Add Cpu0 target to clang.</p>
<p><a class="reference internal" href="lld.html#sec-lld"><span class="std std-ref">Cpu0 ELF linker</span></a>:</p>
<p>Develop ELF linker for Cpu0 backend based on lld project.</p>
<p><a class="reference internal" href="opt.html#sec-opt"><span class="std std-ref">Optimization</span></a>:</p>
<p>Backend independent optimaization.</p>
<p><a class="reference internal" href="lib.html#sec-lib"><span class="std std-ref">Library</span></a>:</p>
<p>Software floating point library and standard C library supporting.</p>
<aside class="footnote brackets" id="gnu" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/GNU_Compiler_Collection#cite_note-55">https://en.wikipedia.org/wiki/GNU_Compiler_Collection#cite_note-55</a></p>
</aside>
<aside class="footnote brackets" id="toolchain" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">2</a><span class="fn-bracket">]</span></span>
<p>page 8 - 9 of  <a class="reference external" href="https://archive.fosdem.org/2018/schedule/event/crosscompile/attachments/slides/2107/export/events/attachments/crosscompile/slides/2107/How_to_cross_compile_with_LLVM_based_tools.pdf">https://archive.fosdem.org/2018/schedule/event/crosscompile/attachments/slides/2107/export/events/attachments/crosscompile/slides/2107/How_to_cross_compile_with_LLVM_based_tools.pdf</a></p>
</aside>
<aside class="footnote brackets" id="toolchain2" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">3</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://bcain-llvm.readthedocs.io/projects/clang/en/latest/Toolchain/#compiler-runtime">https://bcain-llvm.readthedocs.io/projects/clang/en/latest/Toolchain/#compiler-runtime</a></p>
</aside>
<aside class="footnote brackets" id="libgcc" role="note">
<span class="label"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id4">1</a>,<a role="doc-backlink" href="#id5">2</a>)</span>
<p><a class="reference external" href="https://gcc.gnu.org/onlinedocs/gccint/Libgcc.html">https://gcc.gnu.org/onlinedocs/gccint/Libgcc.html</a></p>
</aside>
<aside class="footnote brackets" id="integer-lib" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">5</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://gcc.gnu.org/onlinedocs/gccint/Integer-library-routines.html#Integer-library-routines">https://gcc.gnu.org/onlinedocs/gccint/Integer-library-routines.html#Integer-library-routines</a></p>
</aside>
<aside class="footnote brackets" id="soft-float-lib" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id7">6</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://gcc.gnu.org/onlinedocs/gccint/Soft-float-library-routines.html#Soft-float-library-routines">https://gcc.gnu.org/onlinedocs/gccint/Soft-float-library-routines.html#Soft-float-library-routines</a></p>
</aside>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="index.html">Table of Contents</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="clang.html">Clang</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Chen Chung-Shu.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.2.
    </div>
  </body>
</html>