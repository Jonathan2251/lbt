
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Appendix C: POCL &#8212; Tutorial: Creating an LLVM Toolchain for the Cpu0 Architecture</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/haiku.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Appendix B: Clang library and tools" href="clang-tools.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>Tutorial: Creating an LLVM Toolchain for the Cpu0 Architecture</span></a></h1>
        <h2 class="heading"><span>Appendix C: POCL</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="clang-tools.html">Appendix B: Clang library and tools</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="appendix-c-pocl">
<span id="sec-pocl"></span><h1>Appendix C: POCL<a class="headerlink" href="#appendix-c-pocl" title="Permalink to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#opencl" id="id24">OpenCL</a></p></li>
<li><p><a class="reference internal" href="#run-opencl" id="id25">Run OpenCL</a></p>
<ul>
<li><p><a class="reference internal" href="#macos" id="id26">Macos</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#open-sources" id="id27">Open sources</a></p></li>
<li><p><a class="reference internal" href="#pocl" id="id28">POCL</a></p></li>
<li><p><a class="reference internal" href="#structure" id="id29">Structure</a></p></li>
<li><p><a class="reference internal" href="#gdb-on-pocl" id="id30">GDB on POCL</a></p></li>
<li><p><a class="reference internal" href="#examples-of-compiling-and-running-on-pocl" id="id31">Examples of Compiling and running on POCL</a></p></li>
<li><p><a class="reference internal" href="#riscv-opencl" id="id32">RISCV OpenCL</a></p></li>
<li><p><a class="reference internal" href="#sycl" id="id33">SYCL</a></p></li>
<li><p><a class="reference internal" href="#dpc" id="id34">DPC++</a></p></li>
</ul>
</nav>
<figure class="align-default" id="id20">
<span id="opencl-f"></span><div class="graphviz"><img src="_images/graphviz-21fb840019464deb456541bfacf97b6507bb576b.png" alt="digraph G {
  rankdir=LR;
  subgraph cluster0 {
    label = &quot;Host(X86)&quot;;
    node [shape=box,style=nofilled,color=black]; X86 [label=&quot;CPU&quot;];
    node [shape=box,style=nofilled,color=black]; HMem [label=&quot;MEM&quot;];
  }
  subgraph cluster1 {
    label = &quot;Device(ex, 2-RISCV-Processors)&quot;;
    node [shape=box,style=nofilled,color=black]; RISCV1 [label=&quot;CPU&quot;];
    node [shape=box,style=nofilled,color=black]; DMem1 [label=&quot;MEM&quot;];
    node [shape=box,style=nofilled,color=black]; RISCV2 [label=&quot;CPU&quot;];
    node [shape=box,style=nofilled,color=black]; DMem2 [label=&quot;MEM&quot;];
  }

  HMem -&gt; DMem1 [label=&quot;Send(DMA+Net)&quot;];
  DMem1 -&gt; HMem [label=&quot;Receive(DMA+Net)&quot;];

  HMem -&gt; DMem2 [label=&quot;Send(DMA+Net)&quot;];
  DMem2 -&gt; HMem [label=&quot;Receive(DMA+Net)&quot;];

//  label = &quot;Figure: OpenCL with discrete memory (Device: 2 processor+memory)&quot;;
}" class="graphviz" /></div>
<figcaption>
<p><span class="caption-number">Fig. 17 </span><span class="caption-text">OpenCL with discrete memory (Device: 2 processor+memory)</span><a class="headerlink" href="#id20" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>As <a class="reference internal" href="#opencl-f"><span class="std std-numref">Fig. 17</span></a>, one possible HW platform is that one Host + Device with 2 RISCV
processors and each RISCV has each dedicated memory.</p>
<ul class="simple">
<li><p><a class="reference external" href="info::local_mem_type::global">info::local_mem_type::global</a> -&gt; conherent, CPU cache (SRAM)</p></li>
<li><p><a class="reference external" href="info::local_mem_type::local">info::local_mem_type::local</a> -&gt; dedicated local memory, GPU cache (SRAM)</p></li>
</ul>
<p>OpenCL includes Runtime API, Driver and Compiler three components.
POCL is an open source implementation for Runtime API.</p>
<p>OpenCL Implementation <a class="footnote-reference brackets" href="#ocl-impl" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.
Wiki OpenCL Open source implementations <a class="footnote-reference brackets" href="#wiki-ocl-osi" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>.</p>
<section id="opencl">
<h2><a class="toc-backref" href="#id24" role="doc-backlink">OpenCL</a><a class="headerlink" href="#opencl" title="Permalink to this heading">¶</a></h2>
<p>Builtin-function and builtin-kernel reference here <a class="footnote-reference brackets" href="#builtin-function-kernel" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a>.
Books <a class="footnote-reference brackets" href="#open-cl-book-heter" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a>.
Papers <a class="footnote-reference brackets" href="#ocl-acceler-tf" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a> <a class="footnote-reference brackets" href="#ocl-agpvldl" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></a> <a class="footnote-reference brackets" href="#sycl-aesstgplsmlw" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>10<span class="fn-bracket">]</span></a>  <a class="footnote-reference brackets" href="#ocl-acpcco" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>11<span class="fn-bracket">]</span></a>
<a class="footnote-reference brackets" href="#dlc-acs" id="id9" role="doc-noteref"><span class="fn-bracket">[</span>12<span class="fn-bracket">]</span></a> in lbt/papers/pocl.</p>
</section>
<section id="run-opencl">
<h2><a class="toc-backref" href="#id25" role="doc-backlink">Run OpenCL</a><a class="headerlink" href="#run-opencl" title="Permalink to this heading">¶</a></h2>
<section id="macos">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">Macos</a><a class="headerlink" href="#macos" title="Permalink to this heading">¶</a></h3>
<p>~/git/lbt/exlbt/opencl/opencl-saxpy/opencl-saxpy.xcodeproj can be created by
the following:</p>
<p>Xcode – Create a new Xcode project – macOS – Command Line Tool –
Product Name: opencl-saxpy, Language: C – Next – Create –
“Choose folder ~/git/lbt/exlbt/opencl” –
on left opencl-saxpy folder: delete C main – Move to trash –
“copy saxpy.c to ~/git/lbt/exlbt/opencl/opencl-saxpy/opencl-saxpy” –
on left opencl-saxpy folder: right click mouse “Add files to “opencl-saxpy”” –
save</p>
<p>Build and run saxpy opencl as follows,</p>
<p>Open ~/git/lbt/exlbt/opencl/opencl-saxpy/opencl-saxpy.xcodeproj – Product –
Build – Product – Run, then choose the icons of the following
<a class="reference internal" href="#pocl-f1"><span class="std std-numref">Fig. 18</span></a>  and get the compile options and run-result.</p>
<figure class="align-center" id="id21">
<span id="pocl-f1"></span><a class="reference internal image-reference" href="_images/opencl-saxpy-build-run.png"><img alt="_images/opencl-saxpy-build-run.png" src="_images/opencl-saxpy-build-run.png" style="width: 1396.0px; height: 900.0px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 18 </span><span class="caption-text">Build and run opencl-saxpy.xcodeproj</span><a class="headerlink" href="#id21" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="open-sources">
<h2><a class="toc-backref" href="#id27" role="doc-backlink">Open sources</a><a class="headerlink" href="#open-sources" title="Permalink to this heading">¶</a></h2>
<table class="docutils align-default" id="id22">
<caption><span class="caption-number">Table 8 </span><span class="caption-text">Open sources for OpenCL</span><a class="headerlink" href="#id22" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Project</p></th>
<th class="head"><p>Runtime</p></th>
<th class="head"><p>Driver</p></th>
<th class="head"><p>Compiler</p></th>
<th class="head"><p>Library</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>POCL</p></td>
<td><p>V</p></td>
<td><p>V</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>clang</p></td>
<td></td>
<td></td>
<td><p>V</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>libclc</p></td>
<td></td>
<td></td>
<td></td>
<td><p>V</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id23">
<caption><span class="caption-number">Table 9 </span><span class="caption-text">Open sources for OpenCL 2</span><a class="headerlink" href="#id23" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>project</p></th>
<th class="head"><p>Host Compiler</p></th>
<th class="head"><p>Device Compiler</p></th>
<th class="head"><p>Device Lib</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>POCL</p></td>
<td><p>X86</p></td>
<td><p>X86,ARM,AMD,TCE,PTX</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>clang</p></td>
<td><p>X86</p></td>
<td><p>NVIDIA-gpu, AMD-gpu</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>libclc</p></td>
<td></td>
<td></td>
<td><p>Spir, Spir64, NVIDIA-gpu, AMD-gpu</p></td>
</tr>
</tbody>
</table>
<p>libclc is an open source, BSD/MIT dual licensed implementation of
the library requirements of the OpenCL C programming language <a class="footnote-reference brackets" href="#libclc" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>.</p>
</section>
<section id="pocl">
<h2><a class="toc-backref" href="#id28" role="doc-backlink">POCL</a><a class="headerlink" href="#pocl" title="Permalink to this heading">¶</a></h2>
<p>Pocl web <a class="footnote-reference brackets" href="#pocl-web" id="id11" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a> and documentation <a class="footnote-reference brackets" href="#pocl-doc" id="id12" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>.</p>
<p>PoCL uses Clang as an OpenCL C frontend and LLVM for kernel compiler implementation, and as a portability layer. Thus, if your desired target has an LLVM backend, it should be able to get OpenCL support easily by using PoCL <a class="footnote-reference brackets" href="#pocl-web" id="id13" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>OpenCL is C function with keyword __kernel and some attruibutes in data type. If clang is able to compile input.cl to input.ll, then llvm backend can compile input.ll and link to library.</p>
</div>
<p>Build as the following bash:</p>
<p class="rubric">exlbt/pocl/pocl-install.sh</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/usr/bin/env bash

# add apt repo at first time
# sudo apt-add-repository &#39;deb https://apt.llvm.org/bionic/   llvm-toolchain-bionic-13 main&#39;

# Set POCL_PARENT_DIR for the parent folder of pocl git hub checkout to.
export POCL_PARENT_DIR=$HOME/git

# After &quot;sudo make install&quot;, pocl installed in /usr/local/share/pocl, 
# /usr/local/lib/libpocl.so, /usr/local/lib/pocl and /usr/local/bin/poclcc.

# Ubuntu 18.04 only can use LLVM_VERSION 13. 14 is too new for the dependent 
# packages of Ubuntu 18.04.
export LLVM_VERSION=13
export LLVM_PATH=/usr/lib/llvm-13/bin
#Not work for the following
#LLVM_PATH=$HOME/llvm/13/llvm-project/build/bin

# Ubuntu 22.04 only can use LLVM_VERSION 14. 13 has no /usr/lib/llvm-13/clang 
# after install_dependences().
#LLVM_VERSION=14
#LLVM_PATH=/usr/lib/llvm-14/bin

# Todo:
# Trace test_clCreateKernel.c and test_enqueue_kernel_from_binary.c for running an OpenCL example.

install_dependences() {
  echo &quot;LLVM_VERSION: $LLVM_VERSION&quot;
  sudo apt-get install -y build-essential ocl-icd-libopencl1 cmake git pkg-config \
  libclang-${LLVM_VERSION}-dev clang-${LLVM_VERSION} llvm-${LLVM_VERSION} make ninja-build \
  ocl-icd-libopencl1 ocl-icd-dev ocl-icd-opencl-dev libhwloc-dev zlib1g \
  zlib1g-dev clinfo dialog apt-utils libxml2-dev libclang-cpp${LLVM_VERSION}-dev \
  libclang-cpp${LLVM_VERSION} llvm-${LLVM_VERSION}-dev
}

get_pocl() {
  pushd $POCL_PARENT_DIR
  git clone https://github.com/pocl/pocl
  cd pocl
#  git checkout 4627171d40543091e399989c277faa52fcee0ff8
  popd
}

check() {
  if [ ! -d &quot;$POCL_PARENT_DIR&quot; ]; then
    echo &quot;POCL_PARENT_DIR: $POCL_PARENT_DIR not exist&quot;
    exit 1
  fi
}

build_pocl() {
  pushd $POCL_PARENT_DIR/pocl
  mkdir build
  cd build
# The default uses /usr/bin/cc in ubuntu 18.04
#  cmake -WITH_DLLVM_CONFIG=${LLVM_PATH}/llvm-config ..
# Have verified the following using clang compiler
  cmake -DWITH_LLVM_CONFIG=${LLVM_PATH}/llvm-config \
  -DENABLE_ICD=OFF \
  -DCMAKE_C_COMPILER=${LLVM_PATH}/clang \
  -DCMAKE_CXX_COMPILER=${LLVM_PATH}/clang++ ..
  make
  sudo make install
  popd
}

# Verify tests/runtime/test_clCreateKernel.c using clang rather than cc as follows,
# jonathanchen@hz-compiler1:~/git/pocl/build$ touch ../tests/runtime/test_clCreateKernel.c
# jonathanchen@hz-compiler1:~/git/pocl/build$ make VERBOSE=1 |grep test_clCreateKernel.c
# [ 95%] Building C object tests/runtime/CMakeFiles/test_clCreateKernel.dir/test_clCreateKernel.c.o
# cd /home/jonathanchen/git/pocl/build/tests/runtime &amp;&amp; /usr/lib/llvm-13/bin/clang ...
# -c /home/jonathanchen/git/pocl/tests/runtime/test_clCreateKernel.c

# http://portablecl.org/docs/html/development.html
check_pocl() {
  pushd $POCL_PARENT_DIR/pocl/build
  make check_tier1
  popd
}

install_dependences;
get_pocl;
check;
build_pocl;
check_pocl;
</pre></div>
</div>
<p>Add apt repo on Ubuntu at first time,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo apt-add-repository <span class="s1">&#39;deb https://apt.llvm.org/bionic/   llvm-toolchain-bionic-13 main&#39;</span>
<span class="gp">$ </span>grep <span class="s2">&quot;apt.llvm&quot;</span> /etc/apt/sources.list /etc/apt/sources.list.d/*
<span class="go">/etc/apt/sources.list:deb http://apt.llvm.org/bionic/ llvm-toolchain-bionic-13 main</span>
<span class="go">/etc/apt/sources.list:# deb-src http://apt.llvm.org/bionic/ llvm-toolchain-bionic-13 main</span>
<span class="go">/etc/apt/sources.list:deb https://apt.llvm.org/bionic/ llvm-toolchain-bionic-13 main</span>
<span class="go">/etc/apt/sources.list:# deb-src https://apt.llvm.org/bionic/ llvm-toolchain-bionic-13 main</span>
</pre></div>
</div>
<p>Reference <a class="footnote-reference brackets" href="#pocl-build" id="id14" role="doc-noteref"><span class="fn-bracket">[</span>13<span class="fn-bracket">]</span></a>.</p>
</section>
<section id="structure">
<h2><a class="toc-backref" href="#id29" role="doc-backlink">Structure</a><a class="headerlink" href="#structure" title="Permalink to this heading">¶</a></h2>
<p>Code of Runtime in pocl/lib/CL. Test cases of Runtime in pocl/tests/runtime.</p>
</section>
<section id="gdb-on-pocl">
<h2><a class="toc-backref" href="#id30" role="doc-backlink">GDB on POCL</a><a class="headerlink" href="#gdb-on-pocl" title="Permalink to this heading">¶</a></h2>
<p>After <cite>bash pocl-install.sh</cite>, can run <cite>make check_tier1</cite> but fail on run single
test such as <cite>./tests/runtime/test_clCreateKernelsInProgram</cite> as follows,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">~/git/pocl/build$ POCL_DEBUG=all ./tests/runtime/test_clCreateKernelsInProgram</span>
<span class="go">...</span>
<span class="go">[2022-07-15 08:43:44.140733258219579]POCL: in fn pocl_init_devices at line 529:</span>
<span class="go">  |   WARNING |  cschen:Loading /home/cschen/git/pocl/build/lib/CL/pocl/libpocl-devices-basic.so failed: /home/cschen/git/pocl/build/lib/CL/pocl/libpocl-devices-basic.so: cannot open shared object file: No such file or directory</span>
<span class="go">...</span>
<span class="go">[2022-10-06 08:48:06.140725365544843]POCL: in fn pocl_init_devices at line 584:</span>
<span class="go">  |     ERROR | CL_DEVICE_NOT_FOUND no devices found. POCL_DEVICES=(null)</span>
<span class="go">CL_DEVICE_NOT_FOUND in poclu_get_any_device on line 22</span>
</pre></div>
</div>
<p>Fail to run single test of executable file is not accpetable for tracing code of
pocl. Workaround fix as follows,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">~/git/pocl/build$ touch ../tests/runtime/test_clCreateKernelsInProgram.c</span>
<span class="go">~/git/pocl/build$ make VERBOSE=1|grep test_clCreateKernelsInProgram</span>
<span class="go">...</span>
<span class="go">/usr/lib/llvm-13/bin/clang -g  -pie CMakeFiles/test_clCreateKernelsInProgram.dir/test_clCreateKernelsInProgram.c.o -o test_clCreateKernelsInProgram  -Wl,-rpath,/home/cschen/git/pocl/build/lib/CL ../../poclu/libpoclu.a ../../lib/CL/libOpenCL.so.2.9.0 -L/usr/lib/x86_64-linux-gnu -lhwloc /usr/lib/llvm-13/lib/libclang-cpp.so /usr/lib/llvm-13/lib/libLLVM-13.so -lrt -lm -ldl -lm -ldl</span>
</pre></div>
</div>
<p>Change link path <cite>rpath</cite> from /home/cschen/git/pocl/build/lib/CL to /usr/local/lib for libpocl-devices-basic.so then PASS as follows,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">~/git/pocl/build$ cd /home/jonathanchen/git/pocl/build/tests/runtime</span>
<span class="go">~/git/pocl/build/tests/runtime$ /usr/lib/llvm-13/bin/clang -g  -pie CMakeFiles/test_clCreateKernelsInProgram.dir/test_clCreateKernelsInProgram.c.o -o test_clCreateKernelsInProgram  -Wl,-rpath,/usr/local/lib ../../poclu/libpoclu.a ../../lib/CL/libOpenCL.so.2.9.0 -lhwloc /usr/lib/llvm-13/lib/libclang-cpp.so /usr/lib/llvm-13/lib/libLLVM-13.so -lrt -lm -ldl -lm -pthread -ldl</span>
<span class="go">~/git/pocl/build/tests/runtime$ cd ../..</span>
<span class="go">~/git/pocl/build$ ./tests/runtime/test_clCreateKernelsInProgram</span>
<span class="go">Hello</span>
<span class="go">World</span>
</pre></div>
</div>
<p>Then I can use gdb as follows,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">~/git/pocl/build/$ gdb --args ./tests/runtime/test_clCreateKernelsInProgram</span>
<span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">b test_clCreateKernelsInProgram.c:21</span>
<span class="go">Breakpoint 1 at 0x23b4: file /home/cschen/git/pocl/tests/runtime/test_clCreateKernelsInProgram.c, line 21.</span>
<span class="gp gp-VirtualEnv">(gdb)</span> <span class="go">r</span>
<span class="go">...</span>
<span class="go">Breakpoint 1, main (argc=1, argv=0x7fffffffdfa8) at /home/cschen/git/pocl/tests/runtime/test_clCreateKernelsInProgram.c:23</span>
<span class="go">21        err = poclu_get_any_device(&amp;ctx, &amp;did, &amp;queue);</span>
</pre></div>
</div>
</section>
<section id="examples-of-compiling-and-running-on-pocl">
<h2><a class="toc-backref" href="#id31" role="doc-backlink">Examples of Compiling and running on POCL</a><a class="headerlink" href="#examples-of-compiling-and-running-on-pocl" title="Permalink to this heading">¶</a></h2>
<p>As tracing clang compilation options in last section, I add compile.sh for running OpenCl program on pocl as follows,</p>
<p class="rubric">exlbt/pocl/ex/compile.sh</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/usr/bin/env bash

FILE=test_clCreateKernelsInProgram
#FILE=saxpy

/usr/lib/llvm-13/bin/clang -DCL_HPP_TARGET_OPENCL_VERSION=300 -DCL_TARGET_OPENCL_VERSION=300 -DCL_USE_DEPRECATED_OPENCL_1_0_APIS -DCL_USE_DEPRECATED_OPENCL_1_1_APIS -DCL_USE_DEPRECATED_OPENCL_1_2_APIS -DCL_USE_DEPRECATED_OPENCL_2_0_APIS -DCL_USE_DEPRECATED_OPENCL_2_1_APIS -DCL_USE_DEPRECATED_OPENCL_2_2_APIS -I$HOME/git/pocl/build -I$HOME/git/pocl/include -I$HOME/git/pocl/include/hpp -I$HOME/git/pocl/poclu -I$HOME/git/pocl -g -fPIE -Werror=implicit-function-declaration -Wincompatible-pointer-types -Wno-ignored-attributes -fvisibility=hidden -pthread -MD -MT saxpy.c.o -MF $FILE.c.o.d -o $FILE.c.o -c $FILE.c

/usr/lib/llvm-13/bin/clang -g  -pie $FILE.c.o -o a.out  -Wl,-rpath,/usr/local/lib ~/git/pocl/build/poclu/libpoclu.a ~/git/pocl/build/lib/CL/libOpenCL.so.2.9.0 -lhwloc /usr/lib/llvm-13/lib/libclang-cpp.so /usr/lib/llvm-13/lib/libLLVM-13.so -lrt -lm -ldl -lm -pthread -ldl 
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">~/git/lbt/exlbt/pocl/ex$ POCL_DEBUG=err,warn</span>
<span class="go">~/git/lbt/exlbt/pocl/ex$ bash compile.sh</span>
<span class="go">~/git/lbt/exlbt/pocl/ex$ ./a.out</span>
<span class="go">** Final POCL_DEBUG flags: 18000000000</span>
<span class="go">Hello World!</span>
<span class="go">~/git/lbt/exlbt/pocl/ex$ POCL_DEBUG=</span>
<span class="go">~/git/lbt/exlbt/pocl/ex$ ./a.out</span>
<span class="go">Hello World!</span>
</pre></div>
</div>
<p>References <a class="footnote-reference brackets" href="#pocl-dbg" id="id15" role="doc-noteref"><span class="fn-bracket">[</span>14<span class="fn-bracket">]</span></a>.</p>
</section>
<section id="riscv-opencl">
<h2><a class="toc-backref" href="#id32" role="doc-backlink">RISCV OpenCL</a><a class="headerlink" href="#riscv-opencl" title="Permalink to this heading">¶</a></h2>
<p>In llvm, Mips and Cpu0 can compile .ll file from clang’s output for input OpenCL
while RISCV fail on both 14.x and 15.x as follows,</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">CodeGenOpenCL % pwd</span>
<span class="gp">$</span>HOME/git/lbt/exlbt/pocl
<span class="gp">% </span>~/llvm/14.x/llvm-project/build/bin/clang -cc1 -cl-std<span class="o">=</span>CL2.0 -emit-llvm -triple spir-unknown-unknown test.cl
<span class="gp">% </span>~/llvm/debug/build/bin/llc -march<span class="o">=</span>mips test.ll
<span class="gp">% </span>~/llvm/test/build/bin/llc -march<span class="o">=</span>cpu0 test.ll
<span class="gp">% </span>~/llvm/14.x/llvm-project/build/bin/llc -mtriple<span class="o">=</span>riscv64 test.ll
<span class="go">LLVM ERROR: Unsupported calling convention</span>
<span class="go">...</span>
<span class="gp">% </span>~/llvm/15.x/llvm-project/build/bin/clang -cc1 -cl-std<span class="o">=</span>CL2.0 -emit-llvm -triple spir-unknown-unknown test.cl
<span class="gp">% </span>~/llvm/15.x/llvm-project/build/bin/llc -mtriple<span class="o">=</span>riscv64 test.ll
<span class="go">LLVM ERROR: Unsupported calling convention</span>
<span class="go">...</span>

<span class="go">CodeGenOpenCL % pwd</span>
<span class="gp">$</span>HOME/llvm/14.x/llvm-project/clang/test/CodeGenOpenCL
<span class="go">CodeGenOpenCL % ~/llvm/debug/build/bin/clang -cc1 -cl-std=CL2.0 -emit-llvm -triple spir-unknown-unknown overload.cl</span>
<span class="go">CodeGenOpenCL % ~/llvm/debug/build/bin/llc -march=mips overload.ll</span>
<span class="go">CodeGenOpenCL % ~/llvm/test/build/bin/llc -march=cpu0 overload.ll</span>
<span class="go">CodeGenOpenCL % ~/llvm/14.x/llvm-project/build/bin/llc -mtriple=riscv64 overload.ll</span>
<span class="go">LLVM ERROR: Unsupported calling convention</span>
<span class="go">...</span>
</pre></div>
</div>
</section>
<section id="sycl">
<h2><a class="toc-backref" href="#id33" role="doc-backlink">SYCL</a><a class="headerlink" href="#sycl" title="Permalink to this heading">¶</a></h2>
<p>Webs <a class="footnote-reference brackets" href="#id19" id="id16" role="doc-noteref"><span class="fn-bracket">[</span>15<span class="fn-bracket">]</span></a>. An example <a class="footnote-reference brackets" href="#sycl-wiki" id="id17" role="doc-noteref"><span class="fn-bracket">[</span>16<span class="fn-bracket">]</span></a>.</p>
</section>
<section id="dpc">
<h2><a class="toc-backref" href="#id34" role="doc-backlink">DPC++</a><a class="headerlink" href="#dpc" title="Permalink to this heading">¶</a></h2>
<p>Book <a class="footnote-reference brackets" href="#dpcpp-book" id="id18" role="doc-noteref"><span class="fn-bracket">[</span>17<span class="fn-bracket">]</span></a>.</p>
<p class="rubric">exlbt/pocl/dpc++.txt</p>
<aside class="footnote brackets" id="ocl-impl" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://www.iwocl.org/resources/opencl-implementations/">https://www.iwocl.org/resources/opencl-implementations/</a></p>
</aside>
<aside class="footnote brackets" id="wiki-ocl-osi" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/OpenCL#Open_source_implementations">https://en.wikipedia.org/wiki/OpenCL#Open_source_implementations</a></p>
</aside>
<aside class="footnote brackets" id="libclc" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id10">3</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://libclc.llvm.org">https://libclc.llvm.org</a></p>
</aside>
<aside class="footnote brackets" id="pocl-web" role="note">
<span class="label"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id11">1</a>,<a role="doc-backlink" href="#id13">2</a>)</span>
<p><a class="reference external" href="http://portablecl.org/">http://portablecl.org/</a></p>
</aside>
<aside class="footnote brackets" id="pocl-doc" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id12">5</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://portablecl.org/docs/html/">http://portablecl.org/docs/html/</a></p>
</aside>
<aside class="footnote brackets" id="builtin-function-kernel" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">6</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://jonathan2251.github.io/lbt/clang.html#builtin-functions">http://jonathan2251.github.io/lbt/clang.html#builtin-functions</a></p>
</aside>
<aside class="footnote brackets" id="open-cl-book-heter" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">7</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://dahlan.unimal.ac.id/files/ebooks2/2015%203rd%20Heterogeneous%20Computing%20with%20OpenCL%202.0.pdf">https://dahlan.unimal.ac.id/files/ebooks2/2015%203rd%20Heterogeneous%20Computing%20with%20OpenCL%202.0.pdf</a></p>
</aside>
<aside class="footnote brackets" id="ocl-acceler-tf" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">8</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://mlsys.org/Conferences/doc/2018/84.pdf">https://mlsys.org/Conferences/doc/2018/84.pdf</a></p>
</aside>
<aside class="footnote brackets" id="ocl-agpvldl" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">9</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://www.researchgate.net/publication/350512301_Automatic_Graph_Partitioning_for_Very_Large-scale_Deep_Learning">https://www.researchgate.net/publication/350512301_Automatic_Graph_Partitioning_for_Very_Large-scale_Deep_Learning</a></p>
</aside>
<aside class="footnote brackets" id="sycl-aesstgplsmlw" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id7">10</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://easychair.org/publications/preprint/GjhX">https://easychair.org/publications/preprint/GjhX</a></p>
</aside>
<aside class="footnote brackets" id="ocl-acpcco" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">11</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://www.researchgate.net/publication/221084751_A_comprehensive_performance_comparison_of_CUDA_and_OpenCL">https://www.researchgate.net/publication/221084751_A_comprehensive_performance_comparison_of_CUDA_and_OpenCL</a></p>
</aside>
<aside class="footnote brackets" id="dlc-acs" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id9">12</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://arxiv.org/pdf/2002.03794.pdf">https://arxiv.org/pdf/2002.03794.pdf</a></p>
</aside>
<aside class="footnote brackets" id="pocl-build" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id14">13</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://portablecl.org/docs/html/install.html#configure-build">http://portablecl.org/docs/html/install.html#configure-build</a></p>
</aside>
<aside class="footnote brackets" id="pocl-dbg" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id15">14</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://portablecl.org/docs/html/debug.html">http://portablecl.org/docs/html/debug.html</a></p>
</aside>
<aside class="footnote brackets" id="id19" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id16">15</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://www.khronos.org/sycl">https://www.khronos.org/sycl</a></p>
</aside>
<aside class="footnote brackets" id="sycl-wiki" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id17">16</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/SYCL">https://en.wikipedia.org/wiki/SYCL</a></p>
</aside>
<aside class="footnote brackets" id="dpcpp-book" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id18">17</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://itbook.store/books/9781484255735">https://itbook.store/books/9781484255735</a></p>
</aside>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="clang-tools.html">Appendix B: Clang library and tools</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Chen Chung-Shu.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.2.
    </div>
  </body>
</html>